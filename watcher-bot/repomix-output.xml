This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
ai_watcher.py
check_who_is_playing.py
fetch_real_data.py
find_and_fetch.py
inspect_ohtani.py
inspect_raw.py
main.py
players.py
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="ai_watcher.py">
import requests
import urllib.parse
import webbrowser
import google.generativeai as genai
import json
import re
import time
from datetime import datetime, timedelta
import pytz
from players import WATCH_LIST

# --- ğŸ”§ è¨­å®šã‚¨ãƒªã‚¢ ------------------------------------------------
# æœ¬ç•ª/ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã®URL
NEXTJS_ADMIN_URL = "https://bigluck-stadium.jp/admin/moments"

# Gemini APIã‚­ãƒ¼
GEMINI_API_KEY = "AIzaSyAwjQnE8fGs1mfNlBMYfOBlHrZApLbCOaM"

# ãƒ†ã‚¹ãƒˆç”¨æ—¥ä»˜è¨­å®š (Trueãªã‚‰ç‰¹å®šæ—¥ã‚’ã€Falseãªã‚‰ã€Œä»Šæ—¥ã€ã‚’è¦‹ã¾ã™)
IS_TEST_MODE = True
TEST_TARGET_DATE = "2025-11-01"  # 2025 WS Game 7 (ã¾ãŸã¯ 2024-10-26 ãªã©)
# ------------------------------------------------------------------


TEAM_MAP_PARTIAL = {
    "Dodgers": "LAD", "Marlins": "MIA", "Padres": "SD", "Yankees": "NYY",
    "Cubs": "CHC", "Angels": "LAA", "Red Sox": "BOS", "Mets": "NYM",
    "Braves": "ATL", "Phillies": "PHI", "Giants": "SF", "Rockies": "COL",
    "Diamondbacks": "AZ", "Rays": "TB", "Blue Jays": "TOR", "Orioles": "BAL",
    "White Sox": "CWS", "Royals": "KC", "Tigers": "DET", "Twins": "MIN",
    "Guardians": "CLE", "Mariners": "SEA", "Astros": "HOU", "Rangers": "TEX",
    "Athletics": "OAK", "Nationals": "WSH", "Pirates": "PIT", "Cardinals": "STL",
    "Brewers": "MIL", "Reds": "CIN"
}

genai.configure(api_key=GEMINI_API_KEY)
model = genai.GenerativeModel('gemini-2.0-flash')
WATCH_IDS = {p['id']: p for p in WATCH_LIST}

def get_current_mlb_date():
    tz = pytz.timezone('US/Eastern')
    now = datetime.now(tz)
    return now.strftime('%Y-%m-%d')

def resolve_team_code(team_name):
    for key, code in TEAM_MAP_PARTIAL.items():
        if key in team_name:
            return code
    return "UNKNOWN"

def to_ordinal(n):
    """æ•°å­—ã‚’åºæ•°ã«å¤‰æ› (1->1st, 2->2nd)"""
    try:
        n = int(n)
    except:
        return str(n)
        
    if 11 <= (n % 100) <= 13:
        suffix = 'th'
    else:
        suffix = {1: 'st', 2: 'nd', 3: 'rd'}.get(n % 10, 'th')
    return f"{n}{suffix}"

def to_form_progress(inning_raw, half_raw):
    """
    ç®¡ç†ç”»é¢å½¢å¼ã«å¤‰æ›: "Top 1st", "Bot 9th", "Final"
    """
    # è©¦åˆçµ‚äº†ã®å ´åˆ
    if str(inning_raw) == 'Final' or str(half_raw) == 'Final':
        return 'Final'

    if not inning_raw: return ""
    
    # åºæ•°å¤‰æ› (9 -> 9th)
    inning_ord = to_ordinal(inning_raw)
    
    # Halfã®å¤‰æ› (Top/Bot)
    side = "Bot" if str(half_raw).lower() == 'bottom' else "Top"
    
    return f"{side} {inning_ord}"

def map_event_type_to_form(event_eng):
    """
    APIã®ã‚¤ãƒ™ãƒ³ãƒˆåã‚’ç®¡ç†ç”»é¢ã® <option value="..."> ã«å®Œå…¨ä¸€è‡´ã•ã›ã‚‹
    é¸æŠè‚¢: HOMERUN, VICTORY, RECORD_BREAK, BIG_PLAY
    """
    event_upper = event_eng.upper()
    
    if 'HOME RUN' in event_upper:
        return 'HOMERUN'
    
    # ä¸‰æŒ¯ã€å¥½ãƒ—ãƒ¬ãƒ¼ã€ãƒ’ãƒƒãƒˆãªã©ã¯ã€ŒBIG_PLAY (ãƒ“ãƒƒã‚°ãƒ—ãƒ¬ã‚¤/ä¸‰æŒ¯)ã€ã¸
    if 'STRIKEOUT' in event_upper:
        return 'BIG_PLAY'
    if 'DOUBLE' in event_upper or 'TRIPLE' in event_upper:
        return 'BIG_PLAY'
    if 'STOLEN' in event_upper: # ç›—å¡
        return 'BIG_PLAY'
        
    # å‹åˆ©/è©¦åˆçµ‚äº†
    if 'GAME END' in event_upper:
        return 'VICTORY'
    
    # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ (ãƒ’ãƒƒãƒˆãªã©)
    return 'BIG_PLAY'

def get_japanese_content(english_desc, event_type, player_name, score_str):
    print(f"ğŸ¤– AIãŒ {player_name} ({event_type}) ã®è¨˜äº‹ã‚’åŸ·ç­†ä¸­...")
    
    base_prompt = """
    ã‚ãªãŸã¯ãƒ—ãƒ­é‡çƒã®åŠ‡çš„ãªç¬é–“ã‚’åˆ‡ã‚Šå–ã‚‹ã€Œãƒˆãƒƒãƒ—ãƒˆãƒ¬ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚«ãƒ¼ãƒ‰ã€ã®ãƒ©ã‚¤ã‚¿ãƒ¼ã§ã™ã€‚
    ä»¥ä¸‹ã®MLBå®Ÿæ³ãƒ‡ãƒ¼ã‚¿ï¼ˆè‹±èªï¼‰ã‚’å…ƒã«ã€æ—¥æœ¬èªãƒ†ã‚­ã‚¹ãƒˆã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

    Target Player: {{player}}
    Event Type: {{event}}
    Raw Description: "{{desc}}"
    Current Score: {{score}}

    # é‡è¦ãƒ«ãƒ¼ãƒ«
    1. ç›´è¨³ç¦æ­¢ã€‚ç†±ç‹‚çš„ã«æ„è¨³ã™ã‚‹ã“ã¨ã€‚
    2. æ–‡è„ˆé‡è¦–: Strikeoutã¯ã€Œç©ºæŒ¯ã‚Šä¸‰æŒ¯ã€ã€Œè¦‹é€ƒã—ä¸‰æŒ¯ã€ãªã©ã€‚
    3. ä½“è¨€æ­¢ã‚æ¨å¥¨ã€‚

    # å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ (JSONã®ã¿)
    {
        "title": "20æ–‡å­—ä»¥å†…ã®ã‚¿ã‚¤ãƒˆãƒ«",
        "desc": "60æ–‡å­—ç¨‹åº¦ã®ç†±ç‹‚çš„ãªèª¬æ˜æ–‡",
        "intensity": "5"
    }
    """
    prompt = base_prompt.replace("{{player}}", player_name)
    prompt = prompt.replace("{{event}}", event_type)
    prompt = prompt.replace("{{desc}}", english_desc)
    prompt = prompt.replace("{{score}}", score_str)
    
    max_retries = 3
    for attempt in range(max_retries):
        try:
            response = model.generate_content(prompt)
            clean_text = response.text.replace('```json', '').replace('```', '').strip()
            return json.loads(clean_text)
        except Exception as e:
            if "429" in str(e):
                time.sleep(5)
            else:
                break
    return {"title": event_type, "desc": english_desc, "intensity": "3"}

def check_games_for_highlights():
    target_date = TEST_TARGET_DATE if IS_TEST_MODE else get_current_mlb_date()
    print(f"ğŸ“… {target_date} ã®è©¦åˆã‚’ã‚¹ã‚­ãƒ£ãƒ³ä¸­...")
    
    try:
        url = f"https://statsapi.mlb.com/api/v1/schedule?sportId=1&date={target_date}"
        sched = requests.get(url).json()
    except Exception as e:
        print(f"âŒ æ—¥ç¨‹ã‚¨ãƒ©ãƒ¼: {e}")
        return

    dates = sched.get('dates', [])
    if not dates:
        print("ğŸ’¤ è©¦åˆãƒ‡ãƒ¼ã‚¿ãªã—")
        return

    found_count = 0

    for game in dates[0]['games']:
        game_pk = game['gamePk']
        away_team = game['teams']['away']['team']['name']
        home_team = game['teams']['home']['team']['name']
        
        try:
            feed = requests.get(f"https://statsapi.mlb.com/api/v1.1/game/{game_pk}/feed/live").json()
        except:
            continue

        all_plays = feed.get('liveData', {}).get('plays', {}).get('allPlays', [])
        linescore = feed.get('liveData', {}).get('linescore', {})
        
        home_runs_total = linescore.get('teams', {}).get('home', {}).get('runs', 0)
        away_runs_total = linescore.get('teams', {}).get('away', {}).get('runs', 0)

        for play in all_plays:
            matchup = play.get('matchup', {})
            result = play.get('result', {})
            event = result.get('event', '')
            
            # ã‚¤ãƒ‹ãƒ³ã‚°æƒ…å ±ã®å–å¾—
            about = play.get('about', {})
            current_inning = about.get('inning', '')
            current_half = about.get('halfInning', 'top')
            
            # ğŸ”´ ä¿®æ­£: é€²è¡ŒçŠ¶æ³ã®æ­£è¦åŒ–
            play_progress = to_form_progress(current_inning, current_half)
            
            # ğŸ”´ ä¿®æ­£: ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—ã®æ­£è¦åŒ– (HOMERUN, BIG_PLAYãªã©)
            form_event_type = map_event_type_to_form(event)

            batter_id = matchup.get('batter', {}).get('id')
            pitcher_id = matchup.get('pitcher', {}).get('id')
            target_player_name = None
            
            # åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯
            if batter_id in WATCH_IDS:
                if 'Home Run' in event or 'Hit' in event or 'Double' in event:
                    target_player_name = WATCH_IDS[batter_id]['name']
            elif pitcher_id in WATCH_IDS:
                if 'Strikeout' in event or 'Game End' in event:
                    target_player_name = WATCH_IDS[pitcher_id]['name']

            if target_player_name:
                print(f"\nğŸ”¥ ç™ºè¦‹: {target_player_name} / {form_event_type} / {play_progress}")
                
                ai_content = get_japanese_content(
                    result['description'], event, target_player_name, f"{away_runs_total}-{home_runs_total}"
                )

                payload = {
                    "player": target_player_name,
                    "title": ai_content['title'], 
                    "type": form_event_type, # ã“ã“ãŒ BIG_PLAY ã‚„ HOMERUN ã«ãªã‚Šã¾ã™
                    "desc": ai_content['desc'],
                    "intensity": ai_content['intensity'],
                    "visitor": resolve_team_code(away_team),
                    "home": resolve_team_code(home_team),
                    "visitorScore": away_runs_total,
                    "homeScore": home_runs_total,
                    "progress": play_progress
                }
                
                full_url = f"{NEXTJS_ADMIN_URL}?{urllib.parse.urlencode(payload)}"
                
                print(f"ğŸ”— URL: {full_url}")
                webbrowser.open(full_url)
                
                found_count += 1
                time.sleep(3)

    if found_count == 0:
        print("ğŸ‘€ ãƒã‚¤ãƒ©ã‚¤ãƒˆãªã—")

if __name__ == "__main__":
    check_games_for_highlights()
</file>

<file path="check_who_is_playing.py">
import requests
import json

# 2024/09/19 LAD vs MIA ã®ã¯ãš...
GAME_PK = 746057

def check_players():
    url = f"https://statsapi.mlb.com/api/v1.1/game/{GAME_PK}/feed/live"
    print(f"âš¾ ãƒ‡ãƒ¼ã‚¿å–å¾—ä¸­... (Game ID: {GAME_PK})")
    
    resp = requests.get(url)
    data = resp.json()
    
    # è©¦åˆã®æ—¥æ™‚ã‚„ä¼šå ´æƒ…å ±ã‚’ç¢ºèª
    game_data = data.get('gameData', {})
    datetime = game_data.get('datetime', {})
    venue = game_data.get('venue', {})
    teams = game_data.get('teams', {})
    
    print("\n=== ğŸŸï¸ è©¦åˆæƒ…å ±ç¢ºèª ===")
    print(f"Date: {datetime.get('dateTime')} (Official Date: {datetime.get('officialDate')})")
    print(f"Venue: {venue.get('name')}")
    print(f"Away Team: {teams.get('away', {}).get('name')}")
    print(f"Home Team: {teams.get('home', {}).get('name')}")
    print("========================\n")

    # ãƒ—ãƒ¬ã‚¤ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèª
    all_plays = data.get('liveData', {}).get('plays', {}).get('allPlays', [])
    print(f"ç·ãƒ—ãƒ¬ã‚¤æ•°: {len(all_plays)}")
    print("\n--- ğŸ“ å…¨æ‰“å¸­ãƒªã‚¹ãƒˆ (æœ€åˆã®20ä»¶) ---")

    for i, play in enumerate(all_plays[:20]): # é•·ã„ã®ã§æœ€åˆã®20ä»¶ã ã‘
        matchup = play.get('matchup', {})
        batter = matchup.get('batter', {})
        result = play.get('result', {})
        
        b_id = batter.get('id', 'No ID')
        b_name = batter.get('fullName', 'No Name')
        event = result.get('event', 'No Event')
        
        print(f"[{i}] ID:{b_id} | {b_name} -> {event}")

    # å¤§è°·é¸æ‰‹ã®ID (660271) ãŒãƒ‡ãƒ¼ã‚¿å…¨ä½“ã®ã©ã“ã‹ã«å«ã¾ã‚Œã¦ã„ã‚‹ã‹æ–‡å­—åˆ—æ¤œç´¢
    print("\n--- ğŸ” ãƒ‡ãƒ¼ã‚¿å…¨ä½“ã®ã‚¹ã‚­ãƒ£ãƒ³ ---")
    raw_text = json.dumps(data)
    if "660271" in raw_text:
        print("âœ… ID '660271' (Ohtani) ã¯ãƒ‡ãƒ¼ã‚¿å†…ã«å­˜åœ¨ã—ã¾ã™ï¼")
        print("-> ãƒ‡ãƒ¼ã‚¿ã®æ§‹é€ ï¼ˆãƒ‘ã‚¹ï¼‰ãŒæƒ³å®šã¨é•ã£ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚")
    else:
        print("âŒ ID '660271' (Ohtani) ã¯ãƒ‡ãƒ¼ã‚¿å†…ã«ä¸€åˆ‡å­˜åœ¨ã—ã¾ã›ã‚“ã€‚")
        print("-> è©¦åˆIDãŒé–“é•ã£ã¦ã„ã‚‹ã‹ã€å‡ºå ´ã—ã¦ã„ãªã„è©¦åˆã§ã™ã€‚")

if __name__ == "__main__":
    check_players()
</file>

<file path="fetch_real_data.py">
import requests
import urllib.parse
import webbrowser
import json

# --- è¨­å®š ---
NEXTJS_ADMIN_URL = "http://localhost:3000/admin/moments"

# âœ… ä¿®æ­£: æ­£çœŸæ­£éŠ˜ã® 50-50 é”æˆè©¦åˆ (2024/09/19 LAD vs MIA)
GAME_PK = 746024
OHTANI_ID = 660271

def fetch_game_data(game_pk):
    url = f"https://statsapi.mlb.com/api/v1.1/game/{game_pk}/feed/live"
    print(f"âš¾ ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ä¸­... (Game ID: {game_pk})")
    resp = requests.get(url)
    return resp.json()

def find_homerun_play(game_data):
    all_plays = game_data.get('liveData', {}).get('plays', {}).get('allPlays', [])
    print(f"ç·ãƒ—ãƒ¬ã‚¤æ•°: {len(all_plays)}")
    
    target_play = None
    hr_count = 0

    for play in all_plays:
        matchup = play.get('matchup', {})
        batter = matchup.get('batter', {})
        result = play.get('result', {})
        
        batter_id = batter.get('id')
        event = result.get('event', '')
        
        # å¤§è°·é¸æ‰‹ã®ãƒ›ãƒ¼ãƒ ãƒ©ãƒ³ã‚’æ¢ã™
        if batter_id == OHTANI_ID and 'Home Run' in event:
            hr_count += 1
            print(f"ğŸ”¥ å¤§è°·é¸æ‰‹ã®ãƒ›ãƒ¼ãƒ ãƒ©ãƒ³({hr_count}æœ¬ç›®)ã‚’ç™ºè¦‹ï¼: {result.get('description')[:30]}...")
            # ãƒ«ãƒ¼ãƒ—ã‚’å›ã—ç¶šã‘ã‚‹ã“ã¨ã§ã€è©¦åˆæœ€å¾Œã®HRï¼ˆ51å·ï¼‰ã‚’å–å¾—ã—ã¾ã™
            target_play = play
            
    return target_play

def main():
    try:
        data = fetch_game_data(GAME_PK)
        
        # è©¦åˆæƒ…å ±ã®ç¢ºèªç”¨ãƒ­ã‚°
        teams = data.get('gameData', {}).get('teams', {})
        print(f"Match: {teams.get('away', {}).get('name')} vs {teams.get('home', {}).get('name')}")

        play = find_homerun_play(data)
        
        if not play:
            print("âŒ ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚")
            return

        # ãƒ‡ãƒ¼ã‚¿ã®æŠ½å‡º
        result = play['result']
        matchup = play['matchup']
        
        # åå‰å–å¾— (APIã«fullNameãŒãªã„å ´åˆã®ä¿é™ºä»˜ã)
        player_name = matchup['batter'].get('fullName', 'Shohei Ohtani')
        
        event_payload = {
            "player": player_name,
            "title": f"Event: {result['event']}",
            "desc": result['description'],
            "intensity": "5",
            "visitor": "LAD",
            "home": "MIA"
        }
        
        # URLç”Ÿæˆ
        query_string = urllib.parse.urlencode(event_payload)
        full_url = f"{NEXTJS_ADMIN_URL}?{query_string}"
        
        print("\n" + "="*50)
        print(f"ğŸ‰ ä¼èª¬ã®ç¬é–“ã‚’æ¤œå‡ºã—ã¾ã—ãŸï¼")
        print(f"Play: {event_payload['desc']}")
        print("-" * 50)
        print("Generated URL:")
        print(full_url)
        print("="*50 + "\n")
        
        # ãƒ–ãƒ©ã‚¦ã‚¶èµ·å‹•
        webbrowser.open(full_url)
        
    except Exception as e:
        print(f"ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {e}")

if __name__ == "__main__":
    main()
</file>

<file path="find_and_fetch.py">
import requests
import urllib.parse
import webbrowser
import json

# --- è¨­å®š ---
NEXTJS_ADMIN_URL = "http://localhost:3000/admin/moments"
TARGET_DATE = "2024-09-19" # 50-50 é”æˆæ—¥ (ç¾åœ°æ™‚é–“)
OHTANI_ID = 660271

def find_game_pk(date_str):
    """
    æŒ‡å®šã•ã‚ŒãŸæ—¥ä»˜ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‹ã‚‰ã€ãƒ‰ã‚¸ãƒ£ãƒ¼ã‚¹(LAD)ã®è©¦åˆIDã‚’æ¤œç´¢ã™ã‚‹
    """
    url = f"https://statsapi.mlb.com/api/v1/schedule?sportId=1&date={date_str}"
    print(f"ğŸ“… {date_str} ã®è©¦åˆæ—¥ç¨‹ã‚’æ¤œç´¢ä¸­...")
    
    resp = requests.get(url)
    data = resp.json()
    
    dates = data.get('dates', [])
    if not dates:
        print("âŒ æŒ‡å®šæ—¥ã®è©¦åˆãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚")
        return None
        
    games = dates[0].get('games', [])
    for game in games:
        away = game['teams']['away']['team']['name']
        home = game['teams']['home']['team']['name']
        pk = game['gamePk']
        
        print(f"  - å€™è£œ: {away} vs {home} (ID: {pk})")
        
        # ãƒ‰ã‚¸ãƒ£ãƒ¼ã‚¹æˆ¦ã‚’æ¢ã™
        if 'Dodgers' in away or 'Dodgers' in home:
            print(f"âœ… ãƒ‰ã‚¸ãƒ£ãƒ¼ã‚¹æˆ¦ã‚’ç™ºè¦‹ã—ã¾ã—ãŸï¼ ID: {pk}")
            return pk
            
    print("âŒ ãƒ‰ã‚¸ãƒ£ãƒ¼ã‚¹ã®è©¦åˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚")
    return None

def find_homerun_play(game_pk):
    url = f"https://statsapi.mlb.com/api/v1.1/game/{game_pk}/feed/live"
    print(f"âš¾ è©¦åˆãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ä¸­... (Game ID: {game_pk})")
    
    resp = requests.get(url)
    game_data = resp.json()
    
    all_plays = game_data.get('liveData', {}).get('plays', {}).get('allPlays', [])
    print(f"ç·ãƒ—ãƒ¬ã‚¤æ•°: {len(all_plays)}")
    
    target_play = None
    hr_count = 0

    for play in all_plays:
        matchup = play.get('matchup', {})
        batter = matchup.get('batter', {})
        result = play.get('result', {})
        
        batter_id = batter.get('id')
        event = result.get('event', '')
        
        # å¤§è°·é¸æ‰‹ã®ãƒ›ãƒ¼ãƒ ãƒ©ãƒ³ã‚’æ¢ã™
        if batter_id == OHTANI_ID and 'Home Run' in event:
            hr_count += 1
            print(f"ğŸ”¥ å¤§è°·é¸æ‰‹ã®ãƒ›ãƒ¼ãƒ ãƒ©ãƒ³({hr_count}æœ¬ç›®)ã‚’ç™ºè¦‹ï¼: {result.get('description')[:30]}...")
            # 50å·ã€51å·ã¨ç¶šãã®ã§ã€æœ€å¾Œã®ãƒ‡ãƒ¼ã‚¿ã‚’æ¡ç”¨ï¼ˆä¸Šæ›¸ãï¼‰
            target_play = play
            
    return target_play

def main():
    # 1. ã¾ãšæ­£ã—ã„Game IDã‚’æ—¥ç¨‹ã‹ã‚‰æ¢ã™
    game_pk = find_game_pk(TARGET_DATE)
    if not game_pk:
        return

    # 2. ãã®IDã‚’ä½¿ã£ã¦ãƒ—ãƒ¬ã‚¤ãƒ‡ãƒ¼ã‚¿ã‚’æ¢ã™
    play = find_homerun_play(game_pk)
    
    if not play:
        print("âŒ å¤§è°·é¸æ‰‹ã®ãƒ›ãƒ¼ãƒ ãƒ©ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚")
        return

    # 3. ãƒ‡ãƒ¼ã‚¿æŠ½å‡ºã¨URLç”Ÿæˆ
    result = play['result']
    matchup = play['matchup']
    player_name = matchup['batter'].get('fullName', 'Shohei Ohtani')
    
    event_payload = {
        "player": player_name,
        "title": f"Event: {result['event']}",
        "desc": result['description'],
        "intensity": "5",
        "visitor": "LAD",
        "home": "MIA"
    }
    
    query_string = urllib.parse.urlencode(event_payload)
    full_url = f"{NEXTJS_ADMIN_URL}?{query_string}"
    
    print("\n" + "="*50)
    print(f"ğŸ‰ ä¼èª¬ã®ç¬é–“ã‚’æ¤œå‡ºã—ã¾ã—ãŸï¼")
    print(f"Play: {event_payload['desc']}")
    print("-" * 50)
    print("Generated URL:")
    print(full_url)
    print("="*50 + "\n")
    
    print("ãƒ–ãƒ©ã‚¦ã‚¶ã‚’èµ·å‹•ã—ã¾ã™...")
    webbrowser.open(full_url)

if __name__ == "__main__":
    main()
</file>

<file path="inspect_ohtani.py">
import requests
import json

GAME_PK = 746057  # LAD vs MIA (2024/09/19)

def inspect_ohtani_plays():
    url = f"https://statsapi.mlb.com/api/v1.1/game/{GAME_PK}/feed/live"
    print(f"âš¾ ãƒ‡ãƒ¼ã‚¿ã‚’è§£æä¸­... (Game ID: {GAME_PK})")
    
    resp = requests.get(url)
    data = resp.json()
    all_plays = data.get('liveData', {}).get('plays', {}).get('allPlays', [])
    
    print(f"ç·ãƒ—ãƒ¬ã‚¤æ•°: {len(all_plays)}")
    print("--------------------------------------------------")
    print("ğŸ” 'Ohtani' ã¾ãŸã¯ 'Shohei' ã‚’å«ã‚€ãƒ—ãƒ¬ã‚¤ã‚’æŠ½å‡ºã—ã¾ã™")
    print("--------------------------------------------------")

    found_count = 0
    
    for i, play in enumerate(all_plays):
        # ãƒ‡ãƒ¼ã‚¿ã®å®‰å…¨ãªå–ã‚Šå‡ºã—
        result = play.get('result', {})
        matchup = play.get('matchup', {})
        batter = matchup.get('batter', {})
        
        batter_name = batter.get('fullName', 'Unknown')
        event_name = result.get('event', 'Unknown')
        description = result.get('description', 'No description')
        
        # åå‰ãƒã‚§ãƒƒã‚¯ï¼ˆå¤§è°·é¸æ‰‹ã‹ã©ã†ã‹ï¼‰
        if 'Ohtani' in batter_name or 'Shohei' in batter_name:
            found_count += 1
            print(f"Play Index: {i}")
            print(f"  Player Name: '{batter_name}'")  # ã“ã“ãŒé‡è¦ï¼ˆã‚·ãƒ³ã‚°ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆã§å›²ã£ã¦ä½™è¨ˆãªç©ºç™½ãŒãªã„ã‹è¦‹ã‚‹ï¼‰
            print(f"  Event Name : '{event_name}'")   # ã“ã“ã‚‚é‡è¦
            print(f"  Description: {description[:50]}...")
            print("--------------------------------------------------")

    if found_count == 0:
        print("âŒ 'Ohtani' ã‚‚ 'Shohei' ã‚‚å«ã¾ã‚Œã‚‹é¸æ‰‹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚")
        print("ã‚‚ã—ã‹ã—ã¦: é¸æ‰‹åãŒIDã ã‘ã«ãªã£ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚")

if __name__ == "__main__":
    inspect_ohtani_plays()
</file>

<file path="inspect_raw.py">
import requests
import json

# å¤§è°· 50-50 é”æˆè©¦åˆ
GAME_PK = 746409 

def inspect_data():
    url = f"https://statsapi.mlb.com/api/v1.1/game/{GAME_PK}/feed/live"
    print(f"âš¾ ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ä¸­... (Game ID: {GAME_PK})")
    
    try:
        resp = requests.get(url)
        data = resp.json()
        
        all_plays = data.get('liveData', {}).get('plays', {}).get('allPlays', [])
        
        print(f"å–å¾—ã§ããŸç·ãƒ—ãƒ¬ã‚¤æ•°: {len(all_plays)}")
        print("--------------------------------------------------")
        
        # æœ€åˆã®10ãƒ—ãƒ¬ã‚¤ã ã‘ä¸­èº«ã‚’è©³ã—ãè¡¨ç¤ºã™ã‚‹
        for i, play in enumerate(all_plays[:10]):
            matchup = play.get('matchup', {})
            batter = matchup.get('batter', {})
            result = play.get('result', {})
            
            print(f"Play {i}:")
            print(f"  - Event: {result.get('event')}")
            print(f"  - Batter Name (fullName): {batter.get('fullName')}")
            print(f"  - Batter ID: {batter.get('id')}")
            print(f"  - Desc: {result.get('description')}")
            print("--------------------------------------------------")
            
    except Exception as e:
        print(f"ã‚¨ãƒ©ãƒ¼: {e}")

if __name__ == "__main__":
    inspect_data()
</file>

<file path="main.py">
import urllib.parse
import webbrowser
import time

# --- è¨­å®š ---
# Next.jsãŒå‹•ã„ã¦ã„ã‚‹URLï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒï¼‰
BASE_URL = "http://localhost:3000/admin/moments"

# --- 1. ä»®æƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿ (æœ¬æ¥ã¯ã“ã“ã‚’AIã‚„ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã§ä½œã‚‹) ---
mock_event = {
    "player": "Shohei Ohtani",
    "title": "55th Home Run",
    "desc": "æ‰“çƒé€Ÿåº¦110ãƒã‚¤ãƒ«ã®å¼¾ä¸¸ãƒ©ã‚¤ãƒŠãƒ¼ï¼å‰äººæœªåˆ°ã®è¨˜éŒ²ã‚’æ›´æ–°ã€‚",
    "intensity": "5",       # ç†±ç‹‚åº¦ (1-5)
    "visitor": "LAD",       # ãƒãƒ¼ãƒ ã‚³ãƒ¼ãƒ‰ (Next.jså´ã®å®šç¾©ã¨åˆã‚ã›ã‚‹)
    "home": "SD"
}

def generate_admin_url(data):
    """è¾æ›¸ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚Šã€ç®¡ç†ç”»é¢ã®è‡ªå‹•å…¥åŠ›URLã‚’ç”Ÿæˆã™ã‚‹"""
    query_string = urllib.parse.urlencode(data)
    full_url = f"{BASE_URL}?{query_string}"
    return full_url

if __name__ == "__main__":
    print("ğŸ¤– Watcher Bot: ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ¤œçŸ¥ã—ã¾ã—ãŸ...")
    time.sleep(1) # è¨ˆç®—ã—ã¦ã„ã‚‹ãƒ•ãƒª
    
    # URLç”Ÿæˆ
    url = generate_admin_url(mock_event)
    
    print("\n" + "="*50)
    print("ç”Ÿæˆã•ã‚ŒãŸURL:")
    print(url)
    print("="*50 + "\n")
    
    # ã‚ªãƒ—ã‚·ãƒ§ãƒ³: è‡ªå‹•ã§ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é–‹ãï¼ˆç¢ºèªç”¨ï¼‰
    # ä¸è¦ãªã‚‰ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã—ã¦ãã ã•ã„
    print("ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã„ã¦ã„ã¾ã™...")
    webbrowser.open(url)
</file>

<file path="players.py">
# ç›£è¦–å¯¾è±¡ã®é¸æ‰‹ãƒªã‚¹ãƒˆ (2025-2026ã‚·ãƒ¼ã‚ºãƒ³æœ€æ–°ç‰ˆ)
# IDã¯MLBå…¬å¼ (statsapi.mlb.com / mlb.com) ã®Person IDã‚’ä½¿ç”¨

WATCH_LIST = [
    # --- ğŸ‡ºğŸ‡¸ 2025/2026 æ–°åŠ å…¥ãƒ»æ³¨ç›®é¸æ‰‹ ---
    {"id": 808963, "name": "ä½ã€…æœ¨æœ—å¸Œ", "team_code": "LAD"},  # Dodgers
    {"id": 608372, "name": "è…é‡æ™ºä¹‹", "team_code": "BAL"},    # Orioles
    {"id": 672960, "name": "å²¡æœ¬å’ŒçœŸ", "team_code": "TOR"},    # Blue Jays
    {"id": 808959, "name": "æ‘ä¸Šå®—éš†", "team_code": "CWS"},    # White Sox
    {"id": 829272, "name": "å°ç¬ åŸæ…ä¹‹ä»‹", "team_code": "WSH"},# Nationals

    # --- ğŸŒŸ ãƒ¡ã‚¸ãƒ£ãƒ¼å®šç€ãƒ»ä¸»åŠ›é¸æ‰‹ ---
    {"id": 660271, "name": "å¤§è°·ç¿”å¹³", "team_code": "LAD"},    # Dodgers
    {"id": 808967, "name": "å±±æœ¬ç”±ä¼¸", "team_code": "LAD"},    # Dodgers
    {"id": 506433, "name": "ãƒ€ãƒ«ãƒ“ãƒƒã‚·ãƒ¥æœ‰", "team_code": "SD"}, # Padres
    {"id": 673548, "name": "éˆ´æœ¨èª ä¹Ÿ", "team_code": "CHC"},    # Cubs
    {"id": 684007, "name": "ä»Šæ°¸æ˜‡å¤ª", "team_code": "CHC"},    # Cubs
    {"id": 807799, "name": "å‰ç”°æ­£å°š", "team_code": "BOS"},    # Red Sox
    {"id": 673540, "name": "åƒè³€æ»‰å¤§", "team_code": "NYM"},    # Mets
    {"id": 579328, "name": "èŠæ± é›„æ˜Ÿ", "team_code": "LAA"},    # Angels (2025ç§»ç±)
    {"id": 673451, "name": "æ¾äº•è£•æ¨¹", "team_code": "SD"},     # Padres
    {"id": 628317, "name": "å‰ç”°å¥å¤ª", "team_code": "DET"},    # Tigers

    # --- ğŸ‡¯ğŸ‡µ ä¾ã‚¸ãƒ£ãƒ‘ãƒ³ / æ—¥ç³»é¸æ‰‹ ---
    {"id": 663457, "name": "ãƒ©ãƒ¼ã‚ºãƒ»ãƒŒãƒ¼ãƒˆãƒãƒ¼", "team_code": "STL"}, # Cardinals

    # --- âš ï¸ ãƒã‚¤ãƒŠãƒ¼/æ‹›å¾…é¸æ‰‹ãªã© (å¿…è¦ã«å¿œã˜ã¦ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆè§£é™¤) ---
    # {"id": 642547, "name": "è—¤æµªæ™‹å¤ªéƒ", "team_code": "SEA"}, # Mariners (Minors)
]
</file>

</files>
